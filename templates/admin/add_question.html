{% extends "base.html" %}

{% block title %}Add Question - Cricket Quiz App{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-bold text-gray-800">Add New Question</h2>
        <a href="{{ url_for('admin_dashboard') }}" 
           class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition">
            ‚Üê Back to Dashboard
        </a>
    </div>

    <div class="bg-white rounded-lg shadow-xl p-8">
        <form id="question-form" class="space-y-6">
            <!-- Question Text -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Question Text</label>
                <textarea id="question-text" rows="3" required
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                         placeholder="Enter the question text..."></textarea>
            </div>

            <!-- Question Type -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Question Type</label>
                <select id="question-type" required onchange="toggleOptions()"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Select Type</option>
                    <option value="mcq">Multiple Choice (MCQ)</option>
                    <option value="true_false">True/False</option>
                    <option value="fill_blank">Fill in the Blank</option>
                </select>
            </div>

            <!-- MCQ Options (shown only for MCQ) -->
            <div id="mcq-options" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2">Answer Options</label>
                <div class="space-y-2">
                    <input type="text" id="option-1" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Option A">
                    <input type="text" id="option-2" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Option B">
                    <input type="text" id="option-3" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Option C">
                    <input type="text" id="option-4" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Option D">
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Category -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="category" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Category</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Difficulty -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Difficulty</label>
                    <select id="difficulty" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Difficulty</option>
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>

            <!-- Correct Answer -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Correct Answer</label>
                <input type="text" id="correct-answer" required
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="Enter the correct answer">
                <p class="text-sm text-gray-500 mt-1">For MCQ: Enter the exact option text. For True/False: Enter 'True' or 'False'</p>
            </div>

            <!-- Explanation -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Explanation (Optional)</label>
                <textarea id="explanation" rows="3"
                         class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                         placeholder="Provide an explanation for the answer..."></textarea>
            </div>

            <div class="flex justify-between">
                <button type="button" onclick="resetForm()"
                        class="bg-gray-500 text-white px-6 py-3 rounded-md hover:bg-gray-600 transition duration-200">
                    Reset Form
                </button>
                <button type="submit"
                        class="bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 transition duration-200">
                    Add Question
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function toggleOptions() {
    const type = document.getElementById('question-type').value;
    const mcqOptions = document.getElementById('mcq-options');
    
    if (type === 'mcq') {
        mcqOptions.classList.remove('hidden');
        // Make options required
        for (let i = 1; i <= 4; i++) {
            document.getElementById(`option-${i}`).required = true;
        }
    } else {
        mcqOptions.classList.add('hidden');
        // Remove required from options
        for (let i = 1; i <= 4; i++) {
            document.getElementById(`option-${i}`).required = false;
        }
    }
}

function resetForm() {
    document.getElementById('question-form').reset();
    document.getElementById('mcq-options').classList.add('hidden');
}

document.getElementById('question-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const type = document.getElementById('question-type').value;
    const formData = {
        text: document.getElementById('question-text').value,
        type: type,
        category_id: document.getElementById('category').value,
        difficulty: document.getElementById('difficulty').value,
        correct_answer: document.getElementById('correct-answer').value,
        explanation: document.getElementById('explanation').value
    };
    
    if (type === 'mcq') {
        formData.options = [
            document.getElementById('option-1').value,
            document.getElementById('option-2').value,
            document.getElementById('option-3').value,
            document.getElementById('option-4').value
        ].filter(option => option.trim() !== '');
        
        if (formData.options.length < 2) {
            alert('Please provide at least 2 options for MCQ');
            return;
        }
    }
    
    try {
        const response = await fetch('/admin/save_question', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            alert('Question added successfully!');
            resetForm();
        } else {
            alert('Error adding question: ' + (result.error || 'Unknown error'));
        }
    } catch (error) {
        alert('Error adding question');
        console.error(error);
    }
});
</script>
{% endblock %}